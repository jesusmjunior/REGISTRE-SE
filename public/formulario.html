import React, { useState, useEffect } from 'react';
import { AlertCircle, CheckCircle, Info, X, Eye, Edit2, Trash2, RefreshCw, Search, Save, FileText, List, ArrowUp } from 'lucide-react';

// Configuração da API
const API_CONFIG = {
  URL: 'https://script.google.com/macros/s/AKfycbwRjX5DOrbMGKeEbxGB7tHJ2IsSi6zaUOUqXZ13b02mlIeP8OxziECpJMx46MLYRpGiHg/exec',
};

// Lista de serventias
const SERVENTIAS = [
  "Cartório da 1ª Zona de Registro de Imóveis de São Luis",
  "Cartório do ofício Único de Poção de Pedras",
  "Cartório da 2ª Zona de Registro de Imóveis de São Luis",
  "Cartório do 7º Ofício de Imperatriz",
  "Cartório do 6º Ofício de Imperatriz",
  "Cartório do 1º Ofício de Caxias",
  "Cartório do 1º Ofício de São José de Ribamar",
  "Cartório do 2º Ofício de Açailândia",
  "Cartório do 1º Ofício de Açailândia",
  "Cartório do 1º Ofício de Timon",
  "SERVENTIA EXTRAJUDICIAL DO 1º DE BALSAS  MA",
  "Cartório do 1º Ofício de Santa Inês",
  "Cartório do 1º Ofício de Presidente Dutra",
  "Cartório do 1º Ofício de Codó",
  "Cartório do 1º Ofício de Bacabal",
  "Cartório do 1º Ofício de Barra do Corda",
  "Cartório do 1º Ofício de Pinheiro",
  "Cartório do 1º Ofício de Chapadinha",
  "Cartório do 1º Ofício de Santa Luzia",
  "Cartório do Ofício Único de Buriticupu",
  "Cartório do 1º Ofício de Grajaú",
  "Cartório do 1º Ofício de Itapecuru Mirim",
  "Cartório do 1º Ofício de Coroatá",
  "Cartório do Ofício Único de Tutóia",
  "Cartório do 1º Ofício de Vargem Grande",
  "Cartório de Ofício Único de Viana",
  "Cartório do 2º Ofício de Zé Doca",
  "Cartório do 1º Ofício de Lago da Pedra",
  "Cartório do Ofício Único de Afonso Cunha",
  "Cartório do Ofício Único de Alcântara"
].sort();

const CogexRegistreApp = () => {
  // Estado para controle de abas
  const [activeTab, setActiveTab] = useState('form');
  
  // Estado para o formulário
  const [formData, setFormData] = useState({
    serventia: '',
    telefone: '',
    responsavel: '',
    email: '',
    participacao: 'Sim',
    dataInicio: '',
    classificacao: '',
    acoesRealizadas: '',
    publicosAtendidos: '',
    viasEmitidas: 0,
    registrosNascimento: 0,
    averacoesPaternidade: 0,
    retificacoes: 0,
    registrosTardios: 0,
    restauracoes: 0,
    tags: '',
    motivoNao: '',
    outroMotivo: '',
    observacoes: ''
  });
  
  // Estados para validação
  const [formErrors, setFormErrors] = useState({});
  const [isSubmitting, setIsSubmitting] = useState(false);
  
  // Estados para lista de registros
  const [registros, setRegistros] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');
  const [filteredRegistros, setFilteredRegistros] = useState([]);
  
  // Estados para modais
  const [viewModal, setViewModal] = useState({ show: false, data: null, readonly: true });
  const [deleteModal, setDeleteModal] = useState({ show: false, id: null });
  
  // Estado para notificações toast
  const [toasts, setToasts] = useState([]);

  // Efeitos
  useEffect(() => {
    // Carregar registros se a aba ativa for 'list'
    if (activeTab === 'list') {
      loadRegistros();
    }
  }, [activeTab]);
  
  // Efeito para filtrar registros de acordo com o termo de busca
  useEffect(() => {
    if (registros.length > 0 && searchTerm) {
      const term = searchTerm.toLowerCase();
      const filtered = registros.filter(reg => {
        return (
          (reg.Serventia && reg.Serventia.toLowerCase().includes(term)) ||
          (reg.Responsável && reg.Responsável.toLowerCase().includes(term)) ||
          (reg.Participação && reg.Participação.toLowerCase().includes(term)) ||
          (reg.ID && reg.ID.toString().includes(term))
        );
      });
      setFilteredRegistros(filtered);
    } else {
      setFilteredRegistros(registros);
    }
  }, [searchTerm, registros]);

  // Manipuladores de eventos para o formulário
  const handleInputChange = (e) => {
    const { name, value, type } = e.target;
    
    // Tratar campos numéricos
    if (type === 'number') {
      setFormData({
        ...formData,
        [name]: parseInt(value) || 0
      });
    } else {
      setFormData({
        ...formData,
        [name]: value
      });
    }
    
    // Limpar erro se o campo foi preenchido
    if (formErrors[name]) {
      setFormErrors({
        ...formErrors,
        [name]: null
      });
    }
  };
  
  const handleParticipacaoChange = (e) => {
    const value = e.target.value;
    setFormData({
      ...formData,
      participacao: value
    });
  };
  
  const handleMotivoNaoChange = (e) => {
    const value = e.target.value;
    setFormData({
      ...formData,
      motivoNao: value
    });
  };
  
  const resetForm = () => {
    setFormData({
      serventia: '',
      telefone: '',
      responsavel: '',
      email: '',
      participacao: 'Sim',
      dataInicio: '',
      classificacao: '',
      acoesRealizadas: '',
      publicosAtendidos: '',
      viasEmitidas: 0,
      registrosNascimento: 0,
      averacoesPaternidade: 0,
      retificacoes: 0,
      registrosTardios: 0,
      restauracoes: 0,
      tags: '',
      motivoNao: '',
      outroMotivo: '',
      observacoes: ''
    });
    setFormErrors({});
    addToast('Formulário limpo com sucesso', 'info');
  };
  
  const validateForm = () => {
    const errors = {};
    
    // Validar campos obrigatórios
    if (!formData.serventia) {
      errors.serventia = 'Por favor, selecione uma serventia';
    }
    
    if (!formData.responsavel) {
      errors.responsavel = 'Por favor, informe o nome do responsável';
    }
    
    // Validar campos específicos baseado na participação
    if (formData.participacao === 'Não') {
      if (!formData.motivoNao) {
        errors.motivoNao = 'Por favor, selecione o motivo da não participação';
      }
      
      if (formData.motivoNao === 'Outros' && !formData.outroMotivo) {
        errors.outroMotivo = 'Por favor, especifique o motivo';
      }
    }
    
    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };
  
  // Função para enviar o formulário
  const handleFormSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) {
      return;
    }
    
    setIsSubmitting(true);
    
    try {
      // Preparar dados para API
      const apiData = {
        Serventia: formData.serventia,
        Telefone: formData.telefone,
        Responsável: formData.responsavel,
        Email: formData.email,
        Participação: formData.participacao,
        Timestamp: new Date().toISOString()
      };
      
      // Adicionar campos baseados na participação
      if (formData.participacao === 'Sim') {
        apiData['Data de Início'] = formData.dataInicio;
        apiData['Classificação'] = formData.classificacao;
        apiData['Ações Realizadas'] = formData.acoesRealizadas;
        apiData['Públicos Atendidos'] = formData.publicosAtendidos;
        apiData['Vias Emitidas'] = formData.viasEmitidas;
        apiData['Registros Nascimento'] = formData.registrosNascimento;
        apiData['Averbações Paternidade'] = formData.averacoesPaternidade;
        apiData['Retificações'] = formData.retificacoes;
        apiData['Registros Tardios'] = formData.registrosTardios;
        apiData['Restaurações'] = formData.restauracoes;
        apiData['Tags'] = formData.tags;
      } else {
        apiData['Motivo Não Participação'] = formData.motivoNao === 'Outros' 
          ? `Outros: ${formData.outroMotivo}` 
          : formData.motivoNao;
      }
      
      apiData['Observações'] = formData.observacoes;
      
      // Enviar para a API
      const response = await fetch(API_CONFIG.URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(apiData)
      });
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      const result = await response.json();
      
      if (result.success) {
        addToast(`Registro #${result.data.id} salvo com sucesso!`, 'success');
        resetForm();
        
        // Perguntar se deseja ver os detalhes
        if (window.confirm(`Registro #${result.data.id} salvo com sucesso! Deseja visualizar os detalhes?`)) {
          setActiveTab('list');
          // Aguardar carregamento e destacar o registro
          setTimeout(() => {
            loadRegistros().then(() => {
              highlightRow(result.data.id);
            });
          }, 500);
        }
      } else {
        throw new Error(result.message || 'Erro ao salvar registro');
      }
    } catch (error) {
      addToast(`Erro ao salvar: ${error.message}`, 'error');
      console.error('Erro ao salvar registro:', error);
    } finally {
      setIsSubmitting(false);
    }
  };
  
  // Funções para o sistema de notificações toast
  const addToast = (message, type = 'info') => {
    const id = Date.now();
    setToasts([...toasts, { id, message, type }]);
    
    // Auto-remover após 5 segundos
    setTimeout(() => {
      setToasts(prevToasts => prevToasts.filter(toast => toast.id !== id));
    }, 5000);
  };
  
  const removeToast = (id) => {
    setToasts(prevToasts => prevToasts.filter(toast => toast.id !== id));
  };
  
  // Funções para lidar com a listagem de registros
  const loadRegistros = async () => {
    setIsLoading(true);
    
    try {
      const response = await fetch(`${API_CONFIG.URL}?action=getAll`);
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      const result = await response.json();
      
      if (result.success) {
        // Ordenar por ID (mais recentes primeiro)
        const sortedRegistros = result.data.sort((a, b) => parseInt(b.ID) - parseInt(a.ID));
        setRegistros(sortedRegistros);
        setFilteredRegistros(sortedRegistros);
      } else {
        throw new Error(result.message || 'Erro ao carregar registros');
      }
    } catch (error) {
      addToast(`Erro ao carregar registros: ${error.message}`, 'error');
      console.error('Erro ao carregar registros:', error);
    } finally {
      setIsLoading(false);
    }
  };
  
  const handleSearch = () => {
    // A filtragem é feita pelo useEffect que observa searchTerm
  };
  
  const handleRefresh = () => {
    setSearchTerm('');
    loadRegistros();
  };
  
  const highlightRow = (id) => {
    // Implementar destaque visual para a linha com o ID específico
    const row = document.querySelector(`tr[data-id="${id}"]`);
    if (row) {
      row.classList.add('highlight-row');
      row.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  };
  
  // Funções para modais
  const handleViewRegistro = async (id) => {
    try {
      setIsLoading(true);
      
      const response = await fetch(`${API_CONFIG.URL}?action=getRegistro&id=${id}`);
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      const result = await response.json();
      
      if (result.success) {
        setViewModal({
          show: true,
          data: result.data,
          readonly: true
        });
      } else {
        throw new Error(result.message || 'Erro ao carregar registro');
      }
    } catch (error) {
      addToast(`Erro ao visualizar: ${error.message}`, 'error');
      console.error('Erro ao visualizar registro:', error);
    } finally {
      setIsLoading(false);
    }
  };
  
  const handleEditRegistro = async (id) => {
    try {
      setIsLoading(true);
      
      const response = await fetch(`${API_CONFIG.URL}?action=getRegistro&id=${id}`);
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      const result = await response.json();
      
      if (result.success) {
        setViewModal({
          show: true,
          data: result.data,
          readonly: false
        });
      } else {
        throw new Error(result.message || 'Erro ao carregar registro');
      }
    } catch (error) {
      addToast(`Erro ao editar: ${error.message}`, 'error');
      console.error('Erro ao editar registro:', error);
    } finally {
      setIsLoading(false);
    }
  };
  
  const handleSaveEdit = async () => {
    try {
      setIsLoading(true);
      
      // Coletar dados do modal de edição
      const formEl = document.getElementById('editForm');
      if (!formEl) {
        throw new Error('Formulário de edição não encontrado');
      }
      
      const formData = new FormData(formEl);
      const data = {};
      
      for (let [key, value] of formData.entries()) {
        // Converter campos numéricos
        if (['Vias Emitidas', 'Registros Nascimento', 'Averbações Paternidade', 
             'Retificações', 'Registros Tardios', 'Restaurações'].includes(key)) {
          value = parseInt(value) || 0;
        }
        data[key] = value;
      }
      
      // Adicionar ID
      data.id = viewModal.data.ID;
      
      // Enviar para a API
      const response = await fetch(`${API_CONFIG.URL}?action=atualizarRegistro`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      const result = await response.json();
      
      if (result.success) {
        addToast('Registro atualizado com sucesso!', 'success');
        setViewModal({ show: false, data: null, readonly: true });
        loadRegistros();
      } else {
        throw new Error(result.message || 'Erro ao atualizar registro');
      }
    } catch (error) {
      addToast(`Erro ao atualizar: ${error.message}`, 'error');
      console.error('Erro ao atualizar registro:', error);
    } finally {
      setIsLoading(false);
    }
  };
  
  const handleDeleteClick = (id) => {
    setDeleteModal({
      show: true,
      id
    });
  };
  
  const handleDeleteConfirm = async () => {
    try {
      setIsLoading(true);
      
      const id = deleteModal.id;
      
      const response = await fetch(`${API_CONFIG.URL}?action=excluirRegistro&id=${id}`, {
        method: 'GET'
      });
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      const result = await response.json();
      
      if (result.success) {
        addToast('Registro excluído com sucesso!', 'success');
        setDeleteModal({ show: false, id: null });
        loadRegistros();
      } else {
        throw new Error(result.message || 'Erro ao excluir registro');
      }
    } catch (error) {
      addToast(`Erro ao excluir: ${error.message}`, 'error');
      console.error('Erro ao excluir registro:', error);
    } finally {
      setIsLoading(false);
    }
  };
  
  // Componente para o formulário
  const FormTab = () => (
    <div className="bg-white rounded-lg shadow-md p-6 my-6">
      <h2 className="text-2xl font-bold text-red-900 mb-4 pb-2 border-b-2 border-yellow-400">
        Formulário de Registro - Semana Registre-se
      </h2>
      <p className="text-gray-600 mb-6">
        Preencha os dados referentes à participação da sua serventia na Semana Registre-se.
      </p>
      
      <form onSubmit={handleFormSubmit}>
        {/* Dados da Serventia */}
        <h3 className="text-xl font-semibold mb-4 border-l-4 border-red-900 pl-2">
          Dados da Serventia
        </h3>
        <div className="grid grid-cols-1 md:grid-cols-12 gap-4 mb-6">
          <div className="md:col-span-8">
            <label className="block text-gray-700 font-semibold mb-2">
              Nome da Serventia <span className="text-red-500">*</span>
            </label>
            <select
              className={`w-full p-2 border rounded-md ${formErrors.serventia ? 'border-red-500' : 'border-gray-300'}`}
              name="serventia"
              value={formData.serventia}
              onChange={handleInputChange}
              required
            >
              <option value="">Selecione uma serventia...</option>
              {SERVENTIAS.map((serventia, index) => (
                <option key={index} value={serventia}>{serventia}</option>
              ))}
            </select>
            {formErrors.serventia && (
              <p className="text-red-500 text-sm mt-1">{formErrors.serventia}</p>
            )}
          </div>
          <div className="md:col-span-4">
            <label className="block text-gray-700 font-semibold mb-2">
              Telefone
            </label>
            <input
              type="tel"
              className="w-full p-2 border border-gray-300 rounded-md"
              name="telefone"
              value={formData.telefone}
              onChange={handleInputChange}
              placeholder="(00) 00000-0000"
            />
          </div>
        </div>
        
        <div className="grid grid-cols-1 md:grid-cols-12 gap-4 mb-6">
          <div className="md:col-span-8">
            <label className="block text-gray-700 font-semibold mb-2">
              Nome do Responsável <span className="text-red-500">*</span>
            </label>
            <input
              type="text"
              className={`w-full p-2 border rounded-md ${formErrors.responsavel ? 'border-red-500' : 'border-gray-300'}`}
              name="responsavel"
              value={formData.responsavel}
              onChange={handleInputChange}
              required
            />
            {formErrors.responsavel && (
              <p className="text-red-500 text-sm mt-1">{formErrors.responsavel}</p>
            )}
          </div>
          <div className="md:col-span-4">
            <label className="block text-gray-700 font-semibold mb-2">
              E-mail
            </label>
            <input
              type="email"
              className="w-full p-2 border border-gray-300 rounded-md"
              name="email"
              value={formData.email}
              onChange={handleInputChange}
            />
          </div>
        </div>
        
        {/* Status de Participação */}
        <h3 className="text-xl font-semibold mb-4 border-l-4 border-red-900 pl-2">
          Status de Participação
        </h3>
        <div className="mb-6">
          <div className="flex flex-wrap gap-4">
            <label className="inline-flex items-center">
              <input
                type="radio"
                name="participacao"
                value="Sim"
                checked={formData.participacao === 'Sim'}
                onChange={handleParticipacaoChange}
                className="form-radio text-red-900"
              />
              <span className="ml-2">Participou da Semana Registre-se</span>
            </label>
            <label className="inline-flex items-center">
              <input
                type="radio"
                name="participacao"
                value="Não"
                checked={formData.participacao === 'Não'}
                onChange={handleParticipacaoChange}
                className="form-radio text-red-900"
              />
              <span className="ml-2">Não participou da Semana Registre-se</span>
            </label>
          </div>
        </div>
        
        {/* Campos para Participação Sim */}
        {formData.participacao === 'Sim' && (
          <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded-md mb-6">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  Data de Início das Atividades
                </label>
                <input
                  type="date"
                  className="w-full p-2 border border-gray-300 rounded-md"
                  name="dataInicio"
                  value={formData.dataInicio}
                  onChange={handleInputChange}
                />
              </div>
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  Classificação da Participação
                </label>
                <select
                  className="w-full p-2 border border-gray-300 rounded-md"
                  name="classificacao"
                  value={formData.classificacao}
                  onChange={handleInputChange}
                >
                  <option value="">Selecione...</option>
                  <option value="Integral">Integral - Todos os dias</option>
                  <option value="Parcial">Parcial - Alguns dias</option>
                  <option value="Pontual">Pontual - Ação específica</option>
                </select>
              </div>
            </div>
            
            <div className="mb-4">
              <label className="block text-gray-700 font-semibold mb-2">
                Ações Realizadas
              </label>
              <textarea
                className="w-full p-2 border border-gray-300 rounded-md"
                name="acoesRealizadas"
                value={formData.acoesRealizadas}
                onChange={handleInputChange}
                rows="3"
                placeholder="Descreva as ações realizadas durante a Semana Registre-se..."
              ></textarea>
            </div>
            
            <div className="mb-4">
              <label className="block text-gray-700 font-semibold mb-2">
                Públicos Atendidos
              </label>
              <textarea
                className="w-full p-2 border border-gray-300 rounded-md"
                name="publicosAtendidos"
                value={formData.publicosAtendidos}
                onChange={handleInputChange}
                rows="2"
                placeholder="Informe os grupos sociais atendidos (ex: indígenas, quilombolas, ribeirinhos, etc.)"
              ></textarea>
            </div>
            
            <h4 className="text-lg font-semibold mb-3 mt-6">Dados Quantitativos</h4>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  Total de 2ª Vias Emitidas
                </label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded-md"
                  name="viasEmitidas"
                  value={formData.viasEmitidas}
                  onChange={handleInputChange}
                  min="0"
                />
              </div>
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  Registros de Nascimento
                </label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded-md"
                  name="registrosNascimento"
                  value={formData.registrosNascimento}
                  onChange={handleInputChange}
                  min="0"
                />
              </div>
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  Averbações de Paternidade
                </label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded-md"
                  name="averacoesPaternidade"
                  value={formData.averacoesPaternidade}
                  onChange={handleInputChange}
                  min="0"
                />
              </div>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  Retificações
                </label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded-md"
                  name="retificacoes"
                  value={formData.retificacoes}
                  onChange={handleInputChange}
                  min="0"
                />
              </div>
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  Registros Tardios
                </label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded-md"
                  name="registrosTardios"
                  value={formData.registrosTardios}
                  onChange={handleInputChange}
                  min="0"
                />
              </div>
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  Restaurações
                </label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded-md"
                  name="restauracoes"
                  value={formData.restauracoes}
                  onChange={handleInputChange}
                  min="0"
                />
              </div>
            </div>
            
            <div className="mb-4">
              <label className="block text-gray-700 font-semibold mb-2">
                Tags/Palavras-chave
              </label>
              <input
                type="text"
                className="w-full p-2 border border-gray-300 rounded-md"
                name="tags"
                value={formData.tags}
                onChange={handleInputChange}
                placeholder="Palavras-chave separadas por vírgula"
              />
            </div>
          </div>
        )}
        
        {/* Campos para Participação Não */}
        {formData.participacao === 'Não' && (
          <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded-md mb-6">
            <div className="mb-4">
              <label className="block text-gray-700 font-semibold mb-2">
                Motivo da Não Participação <span className="text-red-500">*</span>
              </label>
              <select
                className={`w-full p-2 border rounded-md ${formErrors.motivoNao ? 'border-red-500' : 'border-gray-300'}`}
                name="motivoNao"
                value={formData.motivoNao}
                onChange={handleMotivoNaoChange}
                required={formData.participacao === 'Não'}
              >
                <option value="">Selecione...</option>
                <option value="Falta de Pessoal">Falta de Pessoal</option>
                <option value="Falta de Recursos">Falta de Recursos</option>
                <option value="Problemas de Infraestrutura">Problemas de Infraestrutura</option>
                <option value="Não houve Demanda Local">Não houve Demanda Local</option>
                <option value="Outros">Outros</option>
              </select>
              {formErrors.motivoNao && (
                <p className="text-red-500 text-sm mt-1">{formErrors.motivoNao}</p>
              )}
            </div>
            
            {formData.motivoNao === 'Outros' && (
              <div className="mb-4">
                <label className="block text-gray-700 font-semibold mb-2">
                  Especifique o Motivo <span className="text-red-500">*</span>
                </label>
                <textarea
                  className={`w-full p-2 border rounded-md ${formErrors.outroMotivo ? 'border-red-500' : 'border-gray-300'}`}
                  name="outroMotivo"
                  value={formData.outroMotivo}
                  onChange={handleInputChange}
                  rows="2"
                  required={formData.motivoNao === 'Outros'}
                ></textarea>
                {formErrors.outroMotivo && (
                  <p className="text-red-500 text-sm mt-1">{formErrors.outroMotivo}</p>
                )}
              </div>
            )}
          </div>
        )}
        
        {/* Observações */}
        <div className="mb-6">
          <label className="block text-gray-700 font-semibold mb-2">
            Observações Adicionais
          </label>
          <textarea
            className="w-full p-2 border border-gray-300 rounded-md"
            name="observacoes"
            value={formData.observacoes}
            onChange={handleInputChange}
            rows="3"
            placeholder="Informações complementares que julgar relevantes..."
          ></textarea>
        </div>
        
        <div className="flex flex-wrap justify-between gap-2 mt-8">
          <button
            type="button"
            className="py-2 px-4 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition"
            onClick={resetForm}
            disabled={isSubmitting}
          >
            <i className="mr-2"></i>Limpar Formulário
          </button>
          <button
            type="submit"
            className="py-2 px-4 bg-red-900 text-white rounded-md hover:bg-red-700 transition"
            disabled={isSubmitting}
          >
            {isSubmitting ? (
              <>
                <i className="mr-2 animate-spin"></i>Salvando...
              </>
            ) : (
              <>
                <Save className="inline mr-2 h-5 w-5" />
                Salvar Registro
              </>
            )}
          </button>
        </div>
      </form>
    </div>
  );
  
  // Componente para a lista de registros
  const ListTab = () => (
    <div className="bg-white rounded-lg shadow-md p-6 my-6">
      <h2 className="text-2xl font-bold text-red-900 mb-4 pb-2 border-b-2 border-yellow-400">
        Consulta de Registros
      </h2>
      
      <div className="flex flex-wrap gap-3 mb-6">
        <div className="flex-grow">
          <div className="flex">
            <input
              type="text"
              className="w-full p-2 border border-gray-300 rounded-l-md"
              placeholder="Pesquisar por serventia, responsável..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
            />
            <button
              className="bg-red-900 text-white p-2 rounded-r-md hover:bg-red-700 transition"
              onClick={handleSearch}
            >
              <Search className="h-5 w-5" />
            </button>
          </div>
        </div>
        <button
          className="py-2 px-4 border border-red-900 text-red-900 rounded-md hover:bg-red-50 transition"
          onClick={handleRefresh}
        >
          <RefreshCw className="inline mr-2 h-4 w-4" />
          Atualizar
        </button>
      </div>
      
      {isLoading ? (
        <div className="text-center py-8">
          <div className="inline-block animate-spin rounded-full h-8 w-8 border-4 border-red-900 border-t-transparent"></div>
          <p className="mt-2 text-gray-600">Carregando registros...</p>
        </div>
      ) : filteredRegistros.length > 0 ? (
        <div className="overflow-x-auto">
          <table className="min-w-full border-collapse">
            <thead>
              <tr className="bg-red-900 text-white">
                <th className="px-4 py-3 text-left">ID</th>
                <th className="px-4 py-3 text-left">Serventia</th>
                <th className="px-4 py-3 text-left">Responsável</th>
                <th className="px-4 py-3 text-left">Participação</th>
                <th className="px-4 py-3 text-left">Registros</th>
                <th className="px-4 py-3 text-left">Data</th>
                <th className="px-4 py-3 text-left">Ações</th>
              </tr>
            </thead>
            <tbody>
              {filteredRegistros.map((registro) => {
                // Calcular total de registros
                const totalRegistros = (
                  parseInt(registro['Registros Nascimento'] || 0) +
                  parseInt(registro['Vias Emitidas'] || 0) +
                  parseInt(registro['Averbações Paternidade'] || 0) +
                  parseInt(registro['Retificações'] || 0) +
                  parseInt(registro['Registros Tardios'] || 0) +
                  parseInt(registro['Restaurações'] || 0)
                );
                
                // Formatar data
                let dataFormatada = 'N/A';
                if (registro['Timestamp']) {
                  try {
                    const data = new Date(registro['Timestamp']);
                    dataFormatada = data.toLocaleDateString('pt-BR');
                  } catch (e) {
                    console.error('Erro ao formatar data:', e);
                  }
                }
                
                return (
                  <tr 
                    key={registro.ID} 
                    data-id={registro.ID}
                    className="border-b border-gray-200 hover:bg-yellow-50 transition"
                  >
                    <td className="px-4 py-3">{registro.ID}</td>
                    <td className="px-4 py-3">{registro['Serventia'] || '—'}</td>
                    <td className="px-4 py-3">{registro['Responsável'] || '—'}</td>
                    <td className="px-4 py-3">
                      <span className={registro['Participação'] === 'Não' ? 'text-red-600' : 'text-green-600'}>
                        {registro['Participação'] || 'Sim'}
                      </span>
                    </td>
                    <td className="px-4 py-3">{totalRegistros}</td>
                    <td className="px-4 py-3">{dataFormatada}</td>
                    <td className="px-4 py-3 flex gap-1">
                      <button
                        className="p-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition"
                        onClick={() => handleViewRegistro(registro.ID)}
                        title="Visualizar"
                      >
                        <Eye className="h-4 w-4" />
                      </button>
                      <button
                        className="p-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition"
                        onClick={() => handleEditRegistro(registro.ID)}
                        title="Editar"
                      >
                        <Edit2 className="h-4 w-4" />
                      </button>
                      <button
                        className="p-1 bg-red-500 text-white rounded hover:bg-red-600 transition"
                        onClick={() => handleDeleteClick(registro.ID)}
                        title="Excluir"
                      >
                        <Trash2 className="h-4 w-4" />
                      </button>
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      ) : (
        <div className="bg-blue-50 text-blue-700 p-4 rounded-md border border-blue-200">
          <Info className="inline mr-2 h-5 w-5" />
          Nenhum registro encontrado.
        </div>
      )}
    </div>
  );
  
  // Componente para o sistema de notificações toast
  const Toast = ({ id, message, type, onClose }) => {
    let bgColor, icon;
    
    switch (type) {
      case 'success':
        bgColor = 'bg-green-500';
        icon = <CheckCircle className="h-5 w-5" />;
        break;
      case 'error':
        bgColor = 'bg-red-500';
        icon = <AlertCircle className="h-5 w-5" />;
        break;
      default:
        bgColor = 'bg-blue-500';
        icon = <Info className="h-5 w-5" />;
    }
    
    return (
      <div className={`flex items-center text-white p-3 rounded-md shadow-md mb-3 ${bgColor}`}>
        <div className="mr-3">{icon}</div>
        <div className="flex-grow">{message}</div>
        <button className="ml-3" onClick={() => onClose(id)}>
          <X className="h-5 w-5" />
        </button>
      </div>
    );
  };
  
  // Modal para visualização/edição de registro
  const RegistroModal = () => {
    if (!viewModal.show) return null;
    
    const registro = viewModal.data;
    const readonly = viewModal.readonly;
    
    // Calcular total de registros
    const totalRegistros = (
      parseInt(registro['Registros Nascimento'] || 0) +
      parseInt(registro['Vias Emitidas'] || 0) +
      parseInt(registro['Averbações Paternidade'] || 0) +
      parseInt(registro['Retificações'] || 0) +
      parseInt(registro['Registros Tardios'] || 0) +
      parseInt(registro['Restaurações'] || 0)
    );
    
    // Formatar data
    let dataFormatada = 'N/A';
    if (registro['Timestamp']) {
      try {
        const data = new Date(registro['Timestamp']);
        dataFormatada = data.toLocaleDateString('pt-BR') + ' ' + 
                       data.toLocaleTimeString('pt-BR');
      } catch (e) {
        console.error('Erro ao formatar data:', e);
      }
    }
    
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div className="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
          <div className="bg-red-900 text-white px-6 py-4 flex justify-between items-center">
            <h3 className="text-xl font-bold">
              {readonly ? `Visualizar Registro #${registro.ID}` : `Editar Registro #${registro.ID}`}
            </h3>
            <button 
              className="text-white hover:text-gray-200"
              onClick={() => setViewModal({ show: false, data: null, readonly: true })}
            >
              <X className="h-6 w-6" />
            </button>
          </div>
          
          <div className="p-6">
            <form id="editForm">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                  <label className="block text-gray-700 font-semibold mb-2">ID:</label>
                  <input 
                    type="text" 
                    className="w-full p-2 border border-gray-300 rounded-md bg-gray-100" 
                    value={registro.ID} 
                    readOnly 
                  />
                </div>
                <div>
                  <label className="block text-gray-700 font-semibold mb-2">Protocolo:</label>
                  <input 
                    type="text" 
                    className="w-full p-2 border border-gray-300 rounded-md bg-gray-100" 
                    value={registro.Protocolo || ''} 
                    readOnly 
                  />
                </div>
                <div>
                  <label className="block text-gray-700 font-semibold mb-2">Data/Hora:</label>
                  <input 
                    type="text" 
                    className="w-full p-2 border border-gray-300 rounded-md bg-gray-100" 
                    value={dataFormatada} 
                    readOnly 
                  />
                </div>
              </div>
              
              <h4 className="text-lg font-semibold mb-3 pb-2 border-b border-gray-200 mt-4">
                Dados da Serventia
              </h4>
              <div className="grid grid-cols-1 md:grid-cols-12 gap-4 mb-4">
                <div className="md:col-span-8">
                  <label className="block text-gray-700 font-semibold mb-2">Serventia:</label>
                  <input 
                    type="text" 
                    className="w-full p-2 border border-gray-300 rounded-md" 
                    name="Serventia" 
                    defaultValue={registro.Serventia} 
                    readOnly={readonly} 
                  />
                </div>
                <div className="md:col-span-4">
                  <label className="block text-gray-700 font-semibold mb-2">Telefone:</label>
                  <input 
                    type="text" 
                    className="w-full p-2 border border-gray-300 rounded-md" 
                    name="Telefone" 
                    defaultValue={registro.Telefone || ''} 
                    readOnly={readonly} 
                  />
                </div>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-12 gap-4 mb-4">
                <div className="md:col-span-8">
                  <label className="block text-gray-700 font-semibold mb-2">Responsável:</label>
                  <input 
                    type="text" 
                    className="w-full p-2 border border-gray-300 rounded-md" 
                    name="Responsavel" 
                    defaultValue={registro.Responsável} 
                    readOnly={readonly} 
                  />
                </div>
                <div className="md:col-span-4">
                  <label className="block text-gray-700 font-semibold mb-2">Email:</label>
                  <input 
                    type="email" 
                    className="w-full p-2 border border-gray-300 rounded-md" 
                    name="Email" 
                    defaultValue={registro.Email || ''} 
                    readOnly={readonly} 
                  />
                </div>
              </div>
              
              <h4 className="text-lg font-semibold mb-3 pb-2 border-b border-gray-200 mt-4">
                Participação
              </h4>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label className="block text-gray-700 font-semibold mb-2">Participou:</label>
                  <select 
                    className="w-full p-2 border border-gray-300 rounded-md" 
                    name="Participacao" 
                    defaultValue={registro.Participação || 'Sim'} 
                    disabled={readonly}
                  >
                    <option value="Sim">Sim</option>
                    <option value="Não">Não</option>
                  </select>
                </div>
                <div>
                  <label className="block text-gray-700 font-semibold mb-2">Data de Início:</label>
                  <input 
                    type="date" 
                    className="w-full p-2 border border-gray-300 rounded-md" 
                    name="Data de Início" 
                    defaultValue={registro['Data de Início'] || ''} 
                    readOnly={readonly} 
                  />
                </div>
              </div>
              
              {registro.Participação !== 'Não' ? (
                <div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                      <label className="block text-gray-700 font-semibold mb-2">Classificação:</label>
                      <select 
                        className="w-full p-2 border border-gray-300 rounded-md" 
                        name="Classificação" 
                        defaultValue={registro.Classificação || ''} 
                        disabled={readonly}
                      >
                        <option value="">Selecione...</option>
                        <option value="Integral">Integral - Todos os dias</option>
                        <option value="Parcial">Parcial - Alguns dias</option>
                        <option value="Pontual">Pontual - Ação específica</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-gray-700 font-semibold mb-2">Total de Registros:</label>
                      <input 
                        type="text" 
                        className="w-full p-2 border border-gray-300 rounded-md bg-gray-100" 
                        value={totalRegistros} 
                        readOnly 
                      />
                    </div>
                  </div>
                  
                  <div className="mb-4">
                    <label className="block text-gray-700 font-semibold mb-2">Ações Realizadas:</label>
                    <textarea 
                      className="w-full p-2 border border-gray-300 rounded-md" 
                      name="Ações Realizadas" 
                      defaultValue={registro['Ações Realizadas'] || ''} 
                      readOnly={readonly}
                      rows="3"
                    ></textarea>
                  </div>
                  
                  <div className="mb-4">
                    <label className="block text-gray-700 font-semibold mb-2">Públicos Atendidos:</label>
                    <textarea 
                      className="w-full p-2 border border-gray-300 rounded-md" 
                      name="Públicos Atendidos" 
                      defaultValue={registro['Públicos Atendidos'] || ''} 
                      readOnly={readonly}
                      rows="2"
                    ></textarea>
                  </div>
                  
                  <h4 className="text-lg font-semibold mb-3 pb-2 border-b border-gray-200 mt-4">
                    Dados Quantitativos
                  </h4>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                      <label className="block text-gray-700 font-semibold mb-2">2ª Vias Emitidas:</label>
                      <input 
                        type="number" 
                        className="w-full p-2 border border-gray-300 rounded-md" 
                        name="Vias Emitidas" 
                        defaultValue={registro['Vias Emitidas'] || 0} 
                        readOnly={readonly}
                        min="0"
                      />
                    </div>
                    <div>
                      <label className="block text-gray-700 font-semibold mb-2">Registros de Nascimento:</label>
                      <input 
                        type="number" 
                        className="w-full p-2 border border-gray-300 rounded-md" 
                        name="Registros Nascimento" 
                        defaultValue={registro['Registros Nascimento'] || 0} 
                        readOnly={readonly}
                        min="0"
                      />
                    </div>
                    <div>
                      <label className="block text-gray-700 font-semibold mb-2">Averbações de Paternidade:</label>
                      <input 
                        type="number" 
                        className="w-full p-2 border border-gray-300 rounded-md" 
                        name="Averbações Paternidade" 
                        defaultValue={registro['Averbações Paternidade'] || 0} 
                        readOnly={readonly}
                        min="0"
                      />
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                      <label className="block text-gray-700 font-semibold mb-2">Retificações:</label>
                      <input 
                        type="number" 
                        className="w-full p-2 border border-gray-300 rounded-md" 
                        name="Retificações" 
                        defaultValue={registro['Retificações'] || 0} 
                        readOnly={readonly}
                        min="0"
                      />
                    </div>
                    <div>
                      <label className="block text-gray-700 font-semibold mb-2">Registros Tardios:</label>
                      <input 
                        type="number" 
                        className="w-full p-2 border border-gray-300 rounded-md" 
                        name="Registros Tardios" 
                        defaultValue={registro['Registros Tardios'] || 0} 
                        readOnly={readonly}
                        min="0"
                      />
                    </div>
                    <div>
                      <label className="block text-gray-700 font-semibold mb-2">Restaurações:</label>
                      <input 
                        type="number" 
                        className="w-full p-2 border border-gray-300 rounded-md" 
                        name="Restaurações" 
                        defaultValue={registro['Restaurações'] || 0} 
                        readOnly={readonly}
                        min="0"
                      />
                    </div>
                  </div>
                  
                  <div className="mb-4">
                    <label className="block text-gray-700 font-semibold mb-2">Tags/Palavras-chave:</label>
                    <input 
                      type="text" 
                      className="w-full p-2 border border-gray-300 rounded-md" 
                      name="Tags" 
                      defaultValue={registro['Tags'] || ''} 
                      readOnly={readonly}
                    />
                  </div>
                </div>
              ) : (
                <div className="mb-4">
                  <label className="block text-gray-700 font-semibold mb-2">Motivo da Não Participação:</label>
                  <input 
                    type="text" 
                    className="w-full p-2 border border-gray-300 rounded-md" 
                    name="Motivo Não Participação" 
                    defaultValue={registro['Motivo Não Participação'] || ''} 
                    readOnly={readonly}
                  />
                </div>
              )}
              
              <div className="mb-4">
                <label className="block text-gray-700 font-semibold mb-2">Observações:</label>
                <textarea 
                  className="w-full p-2 border border-gray-300 rounded-md" 
                  name="Observações" 
                  defaultValue={registro['Observações'] || ''} 
                  readOnly={readonly}
                  rows="3"
                ></textarea>
              </div>
            </form>
          </div>
          
          <div className="bg-gray-100 px-6 py-4 flex justify-end gap-2">
            <button 
              className="py-2 px-4 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition"
              onClick={() => setViewModal({ show: false, data: null, readonly: true })}
            >
              Fechar
            </button>
            {!readonly && (
              <button 
                className="py-2 px-4 bg-red-900 text-white rounded-md hover:bg-red-700 transition"
                onClick={handleSaveEdit}
                disabled={isLoading}
              >
                {isLoading ? (
                  <>
                    <i className="mr-2 animate-spin"></i>Salvando...
                  </>
                ) : (
                  <>
                    <Save className="inline mr-2 h-5 w-5" />
                    Salvar Alterações
                  </>
                )}
              </button>
            )}
          </div>
        </div>
      </div>
    );
  };
  
  // Modal para confirmação de exclusão
  const DeleteConfirmModal = () => {
    if (!deleteModal.show) return null;
    
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div className="bg-white rounded-lg shadow-xl w-full max-w-md">
          <div className="bg-red-600 text-white px-6 py-4 flex justify-between items-center">
            <h3 className="text-xl font-bold">Confirmar Exclusão</h3>
            <button 
              className="text-white hover:text-gray-200"
              onClick={() => setDeleteModal({ show: false, id: null })}
            >
              <X className="h-6 w-6" />
            </button>
          </div>
          
          <div className="p-6">
            <div className="flex items-start">
              <AlertCircle className="text-red-600 mr-4 h-10 w-10 flex-shrink-0" />
              <div>
                <p className="mb-2">
                  Tem certeza que deseja excluir o registro <strong>#{deleteModal.id}</strong>?
                </p>
                <p className="text-red-600 font-semibold">
                  Esta ação não pode ser desfeita.
                </p>
              </div>
            </div>
          </div>
          
          <div className="bg-gray-100 px-6 py-4 flex justify-end gap-2">
            <button 
              className="py-2 px-4 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition"
              onClick={() => setDeleteModal({ show: false, id: null })}
            >
              Cancelar
            </button>
            <button 
              className="py-2 px-4 bg-red-600 text-white rounded-md hover:bg-red-700 transition"
              onClick={handleDeleteConfirm}
              disabled={isLoading}
            >
              {isLoading ? (
                <>
                  <i className="mr-2 animate-spin"></i>Excluindo...
                </>
              ) : (
                <>
                  <Trash2 className="inline mr-2 h-5 w-5" />
                  Excluir
                </>
              )}
            </button>
          </div>
        </div>
      </div>
    );
  };
  
  return (
    <div className="min-h-screen bg-gray-100 p-4">
      <header className="bg-white py-4 px-6 shadow-md rounded-lg flex flex-col md:flex-row items-center justify-between mb-6">
        <div className="flex items-center mb-4 md:mb-0">
          <img src="/api/placeholder/200/70" alt="COGEX Logo" className="h-16" />
          <h1 className="text-2xl font-bold text-red-900 ml-4 hidden md:block">
            COGEX - Semana Registre-se
          </h1>
        </div>
        <div>
          <h2 className="text-xl font-semibold text-gray-700">Sistema de Gestão de Registros</h2>
        </div>
      </header>
      
      {/* Tabs de navegação */}
      <div className="bg-white rounded-lg shadow-md mb-6">
        <div className="flex border-b">
          <button
            className={`px-4 py-3 font-medium ${
              activeTab === 'form'
                ? 'border-b-2 border-red-900 text-red-900'
                : 'text-gray-600 hover:text-red-900'
            }`}
            onClick={() => setActiveTab('form')}
          >
            <FileText className="inline mr-2 h-5 w-5" />
            Novo Registro
          </button>
          <button
            className={`px-4 py-3 font-medium ${
              activeTab === 'list'
                ? 'border-b-2 border-red-900 text-red-900'
                : 'text-gray-600 hover:text-red-900'
            }`}
            onClick={() => setActiveTab('list')}
          >
            <List className="inline mr-2 h-5 w-5" />
            Consultar Registros
          </button>
        </div>
      </div>
      
      {/* Conteúdo das abas */}
      <div className="tab-content">
        {activeTab === 'form' ? <FormTab /> : <ListTab />}
      </div>
      
      {/* Sistema de toast notifications */}
      <div className="fixed top-5 right-5 z-50">
        {toasts.map(toast => (
          <Toast
            key={toast.id}
            id={toast.id}
            message={toast.message}
            type={toast.type}
            onClose={removeToast}
          />
        ))}
      </div>
      
      {/* Modais */}
      <RegistroModal />
      <DeleteConfirmModal />
      
      {/* Botão voltar ao topo */}
      <button
        className="fixed bottom-5 right-5 bg-red-900 text-white p-3 rounded-full shadow-lg hover:bg-red-700 transition"
        onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
      >
        <ArrowUp className="h-5 w-5" />
      </button>
    </div>
  );
};

// Configuração do componente PostgreSQL API
const modifyForPostgreSQL = () => {
  // Modificar a forma como os dados são enviados à API
  const API_BASE_URL = 'https://cogex-api-URL.a.run.app/api';
  
  const transformDataForPostgreSQL = (data) => {
    // Ajustar formato dos dados para o backend Python/PostgreSQL
    return {
      Serventia: data.serventia,
      Responsavel: data.responsavel,
      Email: data.email,
      Telefone: data.telefone,
      Participação: data.participacao,
      "Data de Início": data.dataInicio,
      Classificação: data.classificacao,
      "Ações Realizadas": data.acoesRealizadas,
      "Públicos Atendidos": data.publicosAtendidos,
      "Vias Emitidas": data.viasEmitidas,
      "Registros Nascimento": data.registrosNascimento,
      "Averbações Paternidade": data.averacoesPaternidade,
      "Retificações": data.retificacoes,
      "Registros Tardios": data.registrosTardios,
      "Restaurações": data.restauracoes,
      "Motivo Não Participação": data.motivoNao === 'Outros' 
        ? `Outros: ${data.outroMotivo}` 
        : data.motivoNao,
      "Tags": data.tags,
      "Observações": data.observacoes
    };
  };
  
  // Função adaptada para enviar dados para a API PostgreSQL
  const saveRegistro = async (formData) => {
    const transformedData = transformDataForPostgreSQL(formData);
    
    try {
      const response = await fetch(`${API_BASE_URL}/registrar`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(transformedData)
      });
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error('Erro ao salvar registro:', error);
      throw error;
    }
  };
  
  // Função adaptada para carregar registros da API PostgreSQL
  const loadRegistros = async (filtro = '') => {
    try {
      const url = filtro 
        ? `${API_BASE_URL}/consultar?filtro=${encodeURIComponent(filtro)}`
        : `${API_BASE_URL}/consultar`;
      
      const response = await fetch(url);
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error('Erro ao carregar registros:', error);
      throw error;
    }
  };
  
  // Função adaptada para obter um registro específico
  const getRegistro = async (id) => {
    try {
      const response = await fetch(`${API_BASE_URL}/getRegistro?id=${id}`);
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error('Erro ao obter registro:', error);
      throw error;
    }
  };
  
  // Função adaptada para atualizar um registro
  const updateRegistro = async (id, formData) => {
    const transformedData = transformDataForPostgreSQL(formData);
    transformedData.id = id;
    
    try {
      const response = await fetch(`${API_BASE_URL}/atualizarRegistro`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(transformedData)
      });
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error('Erro ao atualizar registro:', error);
      throw error;
    }
  };
  
  // Função adaptada para excluir um registro
  const deleteRegistro = async (id) => {
    try {
      const response = await fetch(`${API_BASE_URL}/excluirRegistro?id=${id}`);
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error('Erro ao excluir registro:', error);
      throw error;
    }
  };
  
  return {
    saveRegistro,
    loadRegistros,
    getRegistro,
    updateRegistro,
    deleteRegistro
  };
};

// Exportar o componente
export default CogexRegistreApp;
