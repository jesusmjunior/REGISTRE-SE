<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COGEX - Formul√°rio de Registro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Todos os estilos originais mantidos aqui */
        :root {
            --primary: #800020;
            --secondary: #ffcc00;
            --dark: #000000;
            --light: #ffffff;
            --gray: #f8f9fa;
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.7;
            color: #333;
            background-color: #f5f5f5;
        }
        
        /* ... (manter todo o CSS original) ... */
    </style>
</head>
<body>
    <!-- Topbar -->
    <div class="topbar d-none d-md-block">
        <!-- Conte√∫do original da topbar -->
    </div>

    <!-- Header -->
    <header class="main-header">
        <!-- Estrutura original do header -->
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <!-- Cabe√ßalho da p√°gina -->
    </section>

    <!-- Main Content -->
    <div class="container my-5">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="form-tab" data-bs-toggle="tab" data-bs-target="#form-tab-pane" type="button" role="tab" aria-controls="form-tab-pane" aria-selected="true">
                    <i class="fas fa-edit me-2"></i>Formul√°rio
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data-tab-pane" type="button" role="tab" aria-controls="data-tab-pane" aria-selected="false">
                    <i class="fas fa-database me-2"></i>Registros
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <!-- Formul√°rio Tab -->
            <div class="tab-pane fade show active" id="form-tab-pane" role="tabpanel">
                <div class="form-section">
                    <div class="container">
                        <div class="form-container">
                            <form id="registroForm">
                                <!-- Se√ß√µes do formul√°rio mantidas intactas -->
                                
                                <!-- Bot√µes de A√ß√£o Corrigidos -->
                                <div class="row">
                                    <div class="col-md-6 mb-3 mb-md-0">
                                        <button type="reset" class="btn btn-secondary w-100">
                                            <i class="fas fa-sync-alt me-2"></i>Limpar Formul√°rio
                                        </button>
                                    </div>
                                    <div class="col-md-6">
                                        <button type="submit" class="btn btn-primary w-100">
                                            <i class="fas fa-paper-plane me-2"></i>Registrar Participa√ß√£o
                                        </button>
                                    </div>
                                </div>
                                <input type="hidden" id="registroId">
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <!-- Estrutura original do footer -->
    </footer>

    <!-- Scripts Unificados -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        const WEBAPP_URL = "https://script.google.com/macros/s/AKfycby4XaPI4n8bzhs-_O8ogDpdT-VxZ0YaQ06MEccbotf-WWuwjsC2dlhq5ZioYllwnQmP/exec";

        document.addEventListener("DOMContentLoaded", function() {
            // Carregar dados das serventias
            fetch('serventias_registre_se.json')
                .then(response => response.json())
                .then(data => {
                    const selectServentia = document.getElementById('serventia');
                    const selectPublicos = document.getElementById('publicosAtendidos');
                    
                    // Preencher Serventias
                    data.serventias.forEach(item => {
                        selectServentia.add(new Option(item.nome, item.nome));
                    });

                    // Preencher P√∫blicos (exemplo)
                    const publicos = ['Crian√ßas', 'Adolescentes', 'Adultos', 'Idosos', 'PCD'];
                    publicos.forEach(publico => {
                        selectPublicos.add(new Option(publico, publico));
                    });
                })
                .catch(error => console.error('Erro ao carregar dados:', error));

            // Controle din√¢mico de campos
            document.getElementById('participacao').addEventListener('change', function() {
                document.getElementById('motivoNaoSection').style.display = 
                    this.value === 'N√£o' ? 'block' : 'none';
            });

            // Envio do formul√°rio
            document.getElementById("registroForm").addEventListener("submit", async (e) => {
                e.preventDefault();

                // Coletar dados
                const formData = {
                    serventia: document.getElementById("serventia").value,
                    email: document.getElementById("email").value,
                    telefone: document.getElementById("telefone").value,
                    responsavel: document.getElementById("responsavel").value,
                    participacao: document.getElementById("participacao").value,
                    dataInicio: document.getElementById("dataInicio").value,
                    motivoNao: document.getElementById("motivoNao").value,
                    acoesRealizadas: document.getElementById("acoesRealizadas").value,
                    publicosAtendidos: Array.from(document.getElementById("publicosAtendidos").selectedOptions)
                                        .map(opt => opt.value),
                    viasEmitidas: document.getElementById("viasEmitidas").value,
                    registrosNascimento: document.getElementById("registrosNascimento").value,
                    averacoesPaternidade: document.getElementById("averacoesPaternidade").value,
                    retificacoes: document.getElementById("retificacoes").value,
                    registrosTardios: document.getElementById("registrosTardios").value,
                    restauracoes: document.getElementById("restauracoes").value,
                    classificacao: document.getElementById("classificacao").value,
                    tags: document.getElementById("tags").value,
                    observacoes: document.getElementById("observacoes").value,
                    dataRegistro: new Date().toISOString()
                };

                try {
                    // Envio para Google Sheets
                    const response = await fetch(WEBAPP_URL, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) throw new Error(`Erro HTTP! status: ${response.status}`);
                    
                    // Salvamento local
                    const registros = JSON.parse(localStorage.getItem("registrosCogex") || "[]");
                    registros.push(formData);
                    localStorage.setItem("registrosCogex", JSON.stringify(registros));

                    alert('‚úÖ Registro salvo com sucesso!');
                    document.getElementById("registroForm").reset();

                } catch (error) {
                    console.error('Erro:', error);
                    alert(`‚ùå Falha no envio: ${error.message}`);
                }
            });
        });

        // Fun√ß√£o de exporta√ß√£o
        function exportarJSON() {
            const dados = localStorage.getItem("registrosCogex");
            if (!dados || dados === "[]") {
                alert("‚ö†Ô∏è Nenhum dado encontrado!");
                return;
            }
            
            const blob = new Blob([dados], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "backup_registros.json";
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>

    <!-- Bot√£o de Exporta√ß√£o -->
    <div class="container text-end my-3">
        <button type="button" class="btn btn-secondary" onclick="exportarJSON()">
            üì§ Exportar Dados Locais (JSON)
        </button>
    </div>
</body>
</html>
